<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dunstons-Coder | Global Elite IDE</title>
    <link rel="stylesheet" data-name="vs/editor/editor.main" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.43.0/min/vs/editor/editor.main.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg: #0d1117; --panel: #161b22; --accent: #00ff41; 
            --border: #30363d; --text: #c9d1d9; --editor-bg: #1e1e1e;
        }

        * { box-sizing: border-box; }
        body, html { 
            height: 100%; margin: 0; padding: 0; 
            background: var(--bg); color: var(--text);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            overflow: hidden; display: flex; flex-direction: column;
        }

        /* Full Screen Engine Fix */
        .preview-pane.full-mode {
            position: fixed !important; inset: 0 !important;
            width: 100vw !important; height: 100vh !important;
            z-index: 999999 !important; background: #000;
        }

        /* Top Navigation */
        .header {
            height: 55px; background: var(--panel); border-bottom: 1px solid var(--border);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 15px; z-index: 1000;
        }

        .logo { 
            font-weight: 900; color: var(--accent); letter-spacing: 1px; 
            display: flex; align-items: center; gap: 10px; cursor: default;
        }

        .btn-group { display: flex; gap: 8px; }
        
        .btn {
            background: #21262d; color: var(--text); border: 1px solid var(--border);
            padding: 6px 12px; border-radius: 6px; cursor: pointer;
            font-size: 12px; font-weight: 600; display: flex; align-items: center; gap: 6px;
            transition: 0.2s;
        }

        .btn:hover { background: #30363d; border-color: #8b949e; }
        .btn.active { background: rgba(0, 255, 65, 0.1); border-color: var(--accent); color: var(--accent); }
        .btn-run { background: var(--accent); color: #000; border: none; padding: 6px 18px; }
        .btn-run:hover { background: #00cc33; transform: scale(1.02); }

        /* Workspace */
        .main-container { flex: 1; display: flex; min-height: 0; position: relative; }

        .sidebar {
            width: 260px; background: var(--panel); border-right: 1px solid var(--border);
            display: flex; flex-direction: column; transition: transform 0.3s ease;
        }
        .sidebar.hidden { display: none; }

        .editor-area { flex: 1; display: flex; flex-direction: column; background: var(--editor-bg); min-width: 0; }
        #monaco-editor { flex: 1; width: 100%; }

        .resizer { width: 4px; background: var(--bg); cursor: col-resize; transition: 0.2s; }
        .resizer:hover { background: var(--accent); }

        .preview-pane { width: 40%; display: flex; flex-direction: column; background: #000; border-left: 1px solid var(--border); }
        
        .output-tab {
            height: 35px; background: #0d1117; border-bottom: 1px solid var(--border);
            display: flex; align-items: center; padding: 0 15px; font-size: 11px;
            font-weight: bold; color: #8b949e; justify-content: space-between;
        }

        iframe { flex: 1; width: 100%; border: none; background: white; }
        #terminal { 
            flex: 1; padding: 15px; font-family: 'Consolas', monospace; 
            color: var(--accent); font-size: 13px; overflow-y: auto; 
            white-space: pre-wrap; display: none; background: #000;
        }

        /* Modals */
        .modal-overlay {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8);
            z-index: 10000; place-items: center; backdrop-filter: blur(4px);
        }
        .modal {
            background: var(--panel); border: 1px solid var(--border); padding: 30px;
            border-radius: 12px; max-width: 500px; width: 90%; text-align: center;
        }

        select { background: #21262d; color: var(--text); border: 1px solid var(--border); border-radius: 4px; padding: 4px; cursor: pointer; }

        /* Projects List */
        .project-item {
            padding: 10px 15px; margin: 5px; border-radius: 6px; cursor: pointer;
            font-size: 13px; display: flex; justify-content: space-between; align-items: center;
        }
        .project-item:hover { background: #21262d; }
        .project-item.active { background: rgba(0, 255, 65, 0.05); border-left: 3px solid var(--accent); }
    </style>
</head>
<body>

    <div id="maintenanceLock" class="modal-overlay" style="display: none; z-index: 2000000;">
        <div class="modal">
            <h1 style="color:var(--accent)">SYSTEM LOCKED</h1>
            <p>Admin maintenance in progress.</p>
            <input type="password" id="passkey" placeholder="Enter Passkey" style="padding:10px; width:100%; background:#000; border:1px solid var(--border); color:white; margin:15px 0; border-radius:6px; text-align:center">
            <button class="btn btn-run" style="width:100%" onclick="checkLock()">UNLOCK SYSTEM</button>
        </div>
    </div>

    <header class="header">
        <div class="logo">
            <i class="fa-solid fa-terminal"></i> DUNSTONS-CODER
        </div>
        <div class="btn-group">
            <select id="langSelect" onchange="updateLanguage()">
                <option value="html">Web (HTML/CSS/JS)</option>
                <option value="python">Python 3</option>
                <option value="java">Java</option>
                <option value="cpp">C++</option>
                <option value="lua">Lua</option>
            </select>
            <button class="btn" id="autoBtn" onclick="toggleAuto()"><i class="fa-solid fa-bolt"></i> AUTO</button>
            <button class="btn" onclick="downloadFile()"><i class="fa-solid fa-download"></i> SAVE</button>
            <button class="btn" onclick="toggleFull()"><i class="fa-solid fa-expand"></i> FULL</button>
            <button class="btn" onclick="showMission()"><i class="fa-solid fa-circle-info"></i> MISSION</button>
            <button class="btn btn-run" onclick="executeCode()">RUN â–¶</button>
        </div>
    </header>

    <div class="main-container">
        <aside class="sidebar" id="sidebar">
            <div style="padding:15px; font-size:11px; font-weight:800; color:#8b949e;">EXPLORER</div>
            <div id="projectList" style="flex:1; overflow-y:auto;"></div>
            <button class="btn" style="margin:10px; justify-content:center" onclick="newProject()">+ NEW PROJECT</button>
        </aside>

        <div class="editor-area">
            <div id="monaco-editor"></div>
        </div>

        <div class="resizer" id="dragBar"></div>

        <section class="preview-pane" id="previewPane">
            <div class="output-tab">
                <span id="outputTitle">LIVE PREVIEW</span>
                <span onclick="clearOutput()" style="cursor:pointer; font-size:9px;"><i class="fa-solid fa-trash"></i> CLEAR</span>
            </div>
            <iframe id="webOutput"></iframe>
            <div id="terminal"></div>
        </section>
    </div>

    <div id="missionModal" class="modal-overlay">
        <div class="modal">
            <h2 style="margin-top:0">The Mission</h2>
            <p style="text-align:left; line-height:1.6; font-size:14px;">
                <strong>Dunston Jude Bandasa</strong> founded this platform to eliminate barriers to education. 
                Dunstons-Coder provides a professional-grade workspace for developers worldwide, for free.
            </p>
            <button class="btn btn-run" style="width:100%" onclick="hideMission()">START CODING</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>
    <script>
        // CONFIGURATION
        const CONFIG = {
            maintenance: false, // Set to true to lock site
            passkey: "dunten2011",
            api: "https://emkc.org/api/v2/piston/execute"
        };

        let editor, activeProj = 'Default';
        let isAuto = false, autoTimer;
        let storage = JSON.parse(localStorage.getItem('DC_MASTER_STORE')) || {
            'Default': { code: '\n<h1>Start Coding...</h1>', lang: 'html' }
        };

        // Initialize Monaco Engine
        require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.43.0/min/vs' }});
        require(['vs/editor/editor.main'], function() {
            editor = monaco.editor.create(document.getElementById('monaco-editor'), {
                value: storage[activeProj].code,
                language: storage[activeProj].lang,
                theme: 'vs-dark',
                automaticLayout: true,
                fontSize: 14,
                minimap: { enabled: false },
                padding: { top: 15 }
            });

            editor.onDidChangeModelContent(() => {
                storage[activeProj].code = editor.getValue();
                localStorage.setItem('DC_MASTER_STORE', JSON.stringify(storage));
                if(isAuto) {
                    clearTimeout(autoTimer);
                    autoTimer = setTimeout(executeCode, 1000);
                }
            });

            if(CONFIG.maintenance) document.getElementById('maintenanceLock').style.display = 'grid';
            renderProjects();
            executeCode();
        });

        async function executeCode() {
            const code = editor.getValue();
            const lang = document.getElementById('langSelect').value;
            const iframe = document.getElementById('webOutput');
            const term = document.getElementById('terminal');
            const title = document.getElementById('outputTitle');

            if(lang === 'html') {
                title.textContent = "LIVE PREVIEW";
                term.style.display = 'none'; iframe.style.display = 'block';
                iframe.srcdoc = code;
            } else {
                title.textContent = "TERMINAL OUTPUT";
                iframe.style.display = 'none'; term.style.display = 'block';
                term.textContent = "> Running " + lang + " code...";
                
                try {
                    const res = await fetch(CONFIG.api, {
                        method: 'POST',
                        body: JSON.stringify({
                            language: lang,
                            version: "*",
                            files: [{ name: "main", content: code }]
                        })
                    });
                    const data = await res.json();
                    term.textContent = data.run.output || data.run.stderr || "> Process finished.";
                } catch(e) { term.textContent = "Error: Could not connect to Execution Server."; }
            }
        }

        // Logic Functions
        function checkLock() {
            if(document.getElementById('passkey').value === CONFIG.passkey) 
                document.getElementById('maintenanceLock').style.display = 'none';
        }

        function updateLanguage() {
            const l = document.getElementById('langSelect').value;
            monaco.editor.setModelLanguage(editor.getModel(), l);
            storage[activeProj].lang = l;
            executeCode();
        }

        function downloadFile() {
            const blob = new Blob([editor.getValue()], {type: 'text/plain'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            const ext = {html:'html', python:'py', java:'java', cpp:'cpp', lua:'lua'}[document.getElementById('langSelect').value];
            a.download = `${activeProj}.${ext}`;
            a.click();
        }

        function renderProjects() {
            const list = document.getElementById('projectList');
            list.innerHTML = '';
            Object.keys(storage).forEach(name => {
                const div = document.createElement('div');
                div.className = `project-item ${name === activeProj ? 'active' : ''}`;
                div.innerHTML = `<span><i class="fa-regular fa-file"></i> ${name}</span>`;
                div.onclick = () => {
                    activeProj = name;
                    editor.setValue(storage[name].code);
                    document.getElementById('langSelect').value = storage[name].lang;
                    monaco.editor.setModelLanguage(editor.getModel(), storage[name].lang);
                    renderProjects();
                    executeCode();
                };
                list.appendChild(div);
            });
        }

        function newProject() {
            const n = prompt("Project Name:");
            if(n && !storage[n]) {
                storage[n] = { code: '', lang: 'html' };
                activeProj = n;
                renderProjects();
                editor.setValue('');
            }
        }

        function toggleAuto() {
            isAuto = !isAuto;
            document.getElementById('autoBtn').classList.toggle('active');
        }

        function toggleFull() { document.getElementById('previewPane').classList.toggle('full-mode'); }
        window.addEventListener('keydown', e => { if(e.key === 'Escape') document.getElementById('previewPane').classList.remove('full-mode'); });

        function showMission() { document.getElementById('missionModal').style.display = 'grid'; }
        function hideMission() { document.getElementById('missionModal').style.display = 'none'; }
        function clearOutput() { document.getElementById('terminal').textContent = ''; document.getElementById('webOutput').srcdoc = ''; }

        // Resizer Logic
        const dragBar = document.getElementById('dragBar');
        dragBar.addEventListener('mousedown', () => {
            const move = e => {
                let p = (e.clientX / window.innerWidth) * 100;
                if(p > 10 && p < 90) {
                    document.querySelector('.editor-area').style.width = p + '%';
                    document.getElementById('previewPane').style.width = (100 - p) + '%';
                }
            };
            window.addEventListener('mousemove', move);
            window.addEventListener('mouseup', () => window.removeEventListener('mousemove', move));
        });
    </script>
</body>
</html>
