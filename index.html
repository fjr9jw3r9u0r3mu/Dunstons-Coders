<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Dunstons-Coder | Elite Professional IDE</title>
<link rel="stylesheet" data-name="vs/editor/editor.main" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.43.0/min/vs/editor/editor.main.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root{ --bg:#05070a; --panel:#0d1117; --accent:#00ff41; --border:#2b3238; --text:#e6edf3; --vs-bg:#1e1e1e; --danger:#ff4d4d; --glass: rgba(13, 17, 23, 0.8); }
*{box-sizing:border-box; outline:none;}
body,html{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:'Segoe UI', system-ui;overflow:hidden;display:flex;flex-direction:column}

/* Header - Fancy Glassmorphism */
.header{height:60px;background:var(--glass);backdrop-filter:blur(10px);display:flex;align-items:center;justify-content:space-between;padding:0 25px;border-bottom:1px solid var(--border);z-index:100;box-shadow:0 4px 30px rgba(0,0,0,0.5)}
.logo{color:var(--accent);font-weight:900;font-size:20px;letter-spacing:1.5px;text-shadow:0 0 10px rgba(0,255,65,0.3)}
.btn{background:#1a2025;color:var(--text);border:1px solid var(--border);padding:8px 16px;border-radius:8px;cursor:pointer;font-weight:600;font-size:12px;display:flex;align-items:center;gap:8px;transition:0.3s}
.btn:hover{border-color:var(--accent);background:#252b32;box-shadow:0 0 15px rgba(0,255,65,0.2)}

/* Layout Engine */
.app-body{flex:1;display:flex;min-height:0;position:relative}
.sidebar{width:260px;background:var(--panel);border-right:1px solid var(--border);display:flex;flex-direction:column;transition:0.3s cubic-bezier(0.4, 0, 0.2, 1)}
.sidebar.minimized{width:0;opacity:0;pointer-events:none}

.proj-item{padding:12px; background:#161b22; margin:8px; border-radius:10px; cursor:pointer; font-size:13px; display:flex; justify-content:space-between; align-items:center; border:1px solid transparent; transition:0.2s}
.proj-item.active{border-color:var(--accent); background:rgba(0,255,65,0.05); box-shadow:inset 0 0 10px rgba(0,255,65,0.05)}

.editor-container{width:50%; display:flex; flex-direction:column; background:var(--vs-bg); position:relative}
.resizer-bar{width:6px; background:#111; cursor:col-resize; z-index:10; transition:0.3s}
.resizer-bar:hover{background:var(--accent)}

.preview-container{flex:1; background:#fff; display:flex; flex-direction:column; position:relative}
iframe{flex:1; width:100%; border:none; background:#fff}

/* Fancy Output Console */
.console{height:200px; background:#05070a; border-top:1px solid var(--border); transition:0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); display:flex; flex-direction:column}
.console.minimized{height:40px !important}
.console-header{height:40px; background:#0f1418; display:flex; justify-content:space-between; align-items:center; padding:0 20px; cursor:pointer; border-bottom:1px solid var(--border)}
#langOutput{flex:1; padding:20px; font-family:'Fira Code', monospace; color:var(--accent); overflow-y:auto; white-space:pre-wrap; font-size:14px; background:rgba(0,0,0,0.5)}

/* Mission Modal */
.modal{display:none; position:fixed; inset:0; background:rgba(0,0,0,0.95); z-index:10000; place-items:center; backdrop-filter:blur(15px)}
.modal-content{background:var(--panel); padding:40px; border:1px solid var(--border); width:550px; border-radius:24px; text-align:center; box-shadow:0 0 100px rgba(0,255,65,0.1)}
.mission-box{text-align:left; background:rgba(0,0,0,0.3); padding:25px; border-radius:15px; border-left:4px solid var(--accent); margin:25px 0; line-height:1.6}

select{background:#1a2025; color:var(--accent); border:1px solid var(--border); padding:6px 12px; border-radius:8px; font-weight:bold; cursor:pointer}
</style>
</head>
<body>

<header class="header">
    <div style="display:flex;align-items:center;gap:20px">
        <div class="logo">DUNSTONS-CODER</div>
        <button class="btn" onclick="toggleSidebar()"><i class="fa-solid fa-bars-staggered"></i> EXPLORER</button>
        <select id="langSelect" onchange="changeLang()">
            <option value="html">WEB ENGINE</option>
            <option value="python">PYTHON 3</option>
            <option value="java">JAVA (JDK)</option>
            <option value="cpp">C++ (GCC)</option>
        </select>
    </div>
    <div style="display:flex; gap:12px; align-items:center">
        <label style="font-size:11px; color:var(--accent); font-weight:800; cursor:pointer"><input type="checkbox" id="autoRun" checked> AUTO-RUN</label>
        <button class="btn" onclick="openAbout()"><i class="fa-solid fa-shield-halved"></i> OUR MISSION</button>
        <button class="btn" style="background:var(--accent); color:#000" onclick="runCode()">EXECUTE â–¶</button>
    </div>
</header>

<div class="app-body">
    <aside class="sidebar" id="sidebar">
        <div style="padding:20px; font-size:11px; font-weight:bold; opacity:0.4; letter-spacing:1px">SAVED PROJECTS</div>
        <div id="projectList" style="flex:1; overflow-y:auto"></div>
        <div style="padding:15px; border-top:1px solid var(--border)">
            <button class="btn" style="width:100%; justify-content:center" onclick="createNewProject()"><i class="fa-solid fa-plus"></i> NEW PROJECT</button>
        </div>
    </aside>

    <section class="editor-container" id="editorSection">
        <div id="monaco-container" style="flex:1"></div>
    </section>

    <div class="resizer-bar" id="resizer"></div>

    <section class="preview-container">
        <div style="height:35px; background:#f8f9fa; border-bottom:1px solid #ddd; display:flex; align-items:center; padding:0 15px; font-size:10px; font-weight:bold; color:#666">LIVE RENDER VIEW</div>
        <iframe id="outputFrame"></iframe>
        <div id="langOutput"></div>
    </section>
</div>

<div class="console" id="consolePane">
    <div class="console-header" onclick="toggleConsole()">
        <span style="font-size:11px; font-weight:bold; letter-spacing:1px"><i class="fa-solid fa-terminal"></i> SYSTEM TERMINAL</span>
        <i id="minIcon" class="fa-solid fa-chevron-down"></i>
    </div>
    <div id="logBox" style="padding:10px; font-size:12px; color:#555; background:#000">> Ready for input...</div>
</div>

<div class="modal" id="aboutModal">
    <div class="modal-content">
        <div style="background:var(--accent); color:#000; display:inline-block; padding:4px 12px; border-radius:20px; font-weight:900; font-size:10px; margin-bottom:15px">OFFICIAL IDE</div>
        <h1 style="margin:0; font-size:32px">Dunston Jude Bandasa</h1>
        <p style="color:var(--accent); font-weight:bold; margin-top:5px">Form 3 Student | Sabah, Malaysia</p>
        
        <div class="mission-box">
            <p><strong>The Mission:</strong> Dunston created this site to provide everyone in the world a chance to learn and do coding for free with no limits.</p>
            <p style="margin-top:15px"><strong>Support:</strong> Dedicated to empowering <strong>Sabah students</strong> to become global tech leaders from their own homes.</p>
        </div>
        
        <button class="btn" style="width:100%; justify-content:center; background:var(--accent); color:#000; padding:15px; font-weight:800" onclick="closeAbout()">START BUILDING</button>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>
<script>
// --- PERMANENT STORAGE ENGINE ---
let editor, activeProj = localStorage.getItem('DC_LastProj') || 'Default';
let projects = JSON.parse(localStorage.getItem('DC_Storage_V4')) || { 'Default': { code: '<h1>Start Coding</h1>', lang: 'html' } };

require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.43.0/min/vs' }});
require(['vs/editor/editor.main'], function() {
    editor = monaco.editor.create(document.getElementById('monaco-container'), {
        value: projects[activeProj].code,
        language: projects[activeProj].lang,
        theme: 'vs-dark',
        automaticLayout: true,
        fontSize: 14,
        fontFamily: "'Fira Code', monospace",
        minimap: { enabled: false },
        cursorSmoothCaretAnimation: "on"
    });

    // AUTO-SAVE ON EVERY KEYSTROKE
    editor.onDidChangeModelContent(() => {
        projects[activeProj].code = editor.getValue();
        localStorage.setItem('DC_Storage_V4', JSON.stringify(projects));
        if(document.getElementById('autoRun').checked) {
            clearTimeout(window.runTimer);
            window.runTimer = setTimeout(runCode, 1000);
        }
    });

    renderProjects();
    runCode();
});

async function runCode() {
    const code = editor.getValue();
    const lang = document.getElementById('langSelect').value;
    const frame = document.getElementById('outputFrame');
    const langDiv = document.getElementById('langOutput');
    const logBox = document.getElementById('logBox');

    logBox.innerHTML = "> Executing...";
    if (lang === 'html') {
        langDiv.style.display = 'none'; frame.style.display = 'block';
        frame.srcdoc = code;
    } else {
        frame.style.display = 'none'; langDiv.style.display = 'block';
        try {
            const res = await fetch('https://emkc.org/api/v2/piston/execute', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    language: lang, 
                    version: "*", 
                    files: [{ name: lang === 'java' ? 'Main.java' : 'index', content: code }] 
                })
            });
            const data = await res.json();
            langDiv.textContent = data.run.output || data.run.stderr || "Success (No Output)";
            logBox.innerHTML = "> Execution Complete.";
        } catch (e) { logBox.innerHTML = "> Engine connection failed."; }
    }
}

// --- PROJECT SYSTEM ---
function renderProjects() {
    const list = document.getElementById('projectList');
    list.innerHTML = '';
    Object.keys(projects).forEach(name => {
        const div = document.createElement('div');
        div.className = `proj-item ${name === activeProj ? 'active' : ''}`;
        div.innerHTML = `<span><i class="fa-solid fa-file-code"></i> ${name}</span><i class="fa-solid fa-xmark" style="opacity:0.3" onclick="deleteProj('${name}')"></i>`;
        div.onclick = (e) => { if(e.target.tagName !== 'I') loadProj(name); };
        list.appendChild(div);
    });
}

function loadProj(name) {
    activeProj = name;
    localStorage.setItem('DC_LastProj', name);
    editor.setValue(projects[name].code);
    document.getElementById('langSelect').value = projects[name].lang;
    monaco.editor.setModelLanguage(editor.getModel(), projects[name].lang);
    renderProjects();
    runCode();
}

function createNewProject() {
    const name = prompt("Project Name:");
    if(name && !projects[name]) { 
        projects[name] = { code: '', lang: 'html' }; 
        loadProj(name); 
    }
}

function deleteProj(name) {
    if(Object.keys(projects).length > 1 && confirm(`Delete "${name}"?`)) {
        delete projects[name];
        if(activeProj === name) activeProj = Object.keys(projects)[0];
        localStorage.setItem('DC_Storage_V4', JSON.stringify(projects));
        renderProjects();
    }
}

// --- UI HELPERS ---
function toggleConsole() {
    const c = document.getElementById('consolePane');
    c.classList.toggle('minimized');
    document.getElementById('minIcon').className = c.classList.contains('minimized') ? 'fa-solid fa-chevron-up' : 'fa-solid fa-chevron-down';
}

function toggleSidebar() { document.getElementById('sidebar').classList.toggle('minimized'); }
function openAbout() { document.getElementById('aboutModal').style.display = 'grid'; }
function closeAbout() { document.getElementById('aboutModal').style.display = 'none'; }
function changeLang() { 
    projects[activeProj].lang = document.getElementById('langSelect').value;
    monaco.editor.setModelLanguage(editor.getModel(), projects[activeProj].lang);
    runCode();
}

// Resizer
const resizer = document.getElementById('resizer');
resizer.onmousedown = () => {
    document.onmousemove = (e) => {
        let p = (e.clientX / window.innerWidth) * 100;
        if(p > 10 && p < 90) document.getElementById('editorSection').style.width = p + '%';
    };
    document.onmouseup = () => { document.onmousemove = null; editor.layout(); };
};
</script>
</body>
</html>
