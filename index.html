<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dunstons-Coder v20 | The Singularity</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>

    <style>
        :root { --bg-dark: #050505; --bg-panel: #0f0f11; --border: #1f1f23; --accent: #22c55e; }
        body { background: var(--bg-dark); color: #f4f4f5; font-family: 'Inter', sans-serif; height: 100vh; overflow: hidden; }
        
        .monaco-editor { padding-top: 8px; }
        #terminal-output { font-family: 'Fira Code', monospace; font-size: 13px; line-height: 1.6; }
        
        /* UI Enhancements */
        .glass { background: rgba(15, 15, 17, 0.7); backdrop-filter: blur(12px); }
        .tab-active { background: #1e1e1e; border-bottom: 2px solid var(--accent); color: var(--accent); }
        .panel-transition { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent); }

        .ansi-red { color: #ff5555; } .ansi-green { color: #50fa7b; }
        iframe { background: white; width: 100%; height: 100%; border: none; }
    </style>
</head>
<body class="flex flex-col select-none">

    <header class="h-12 bg-black border-b border-[#1f1f23] flex items-center justify-between px-4 z-50">
        <div class="flex items-center gap-6">
            <div class="flex items-center gap-2">
                <div class="w-7 h-7 bg-green-500 rounded flex items-center justify-center shadow-[0_0_15px_rgba(34,197,94,0.3)]">
                    <i class="fa-solid fa-bolt text-black text-xs"></i>
                </div>
                <h1 class="font-black text-sm tracking-tighter uppercase italic">Dunstons-<span class="text-green-500">Coder</span></h1>
            </div>
            
            <nav class="flex gap-4 text-[10px] font-bold text-gray-500 uppercase tracking-widest">
                <button onclick="openModal('mission')" class="hover:text-green-500 transition">Missions</button>
                <button onclick="openModal('projects')" class="hover:text-green-500 transition">Projects</button>
                <button onclick="openModal('about')" class="hover:text-green-500 transition">Founder</button>
            </nav>
        </div>

        <div class="flex items-center gap-4">
            <div id="save-indicator" class="text-[9px] text-gray-600 font-mono uppercase">Cloud-Sync Active</div>
            <button onclick="exportProject()" class="text-gray-400 hover:text-white" title="Export Project"><i class="fa-solid fa-file-export"></i></button>
            <button id="ai-hint-btn" onclick="getAIHint()" class="bg-indigo-600/20 text-indigo-400 border border-indigo-600/30 px-3 py-1 rounded-full text-[10px] font-bold hover:bg-indigo-600 hover:text-white transition">
                <i class="fa-solid fa-wand-sparkles mr-1"></i> AI HINT
            </button>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        
        <aside class="w-60 bg-[#0a0a0c] border-r border-[#1f1f23] flex flex-col">
            <div class="p-3">
                <button onclick="createNewFile()" class="w-full bg-white text-black py-2 rounded text-[11px] font-black uppercase hover:bg-green-500 transition">
                    New File
                </button>
            </div>
            <div id="file-tree" class="flex-1 overflow-y-auto px-2 space-y-1"></div>
            
            <div class="p-4 border-t border-[#1f1f23] bg-black/50">
                <div class="text-[9px] text-gray-500 mb-2 font-bold uppercase tracking-widest">Target Engine</div>
                <select id="lang-select" onchange="updateLang()" class="w-full bg-[#121214] text-xs text-white p-2 rounded border border-[#1f1f23] outline-none focus:border-green-500">
                    <option value="python">Python 3.10</option>
                    <option value="cpp">C++ 20 (GCC)</option>
                    <option value="java">Java OpenJDK</option>
                    <option value="javascript">Node.js</option>
                    <option value="html">Web (Live)</option>
                </select>
                <button id="run-btn" onclick="runCode()" class="w-full mt-3 bg-green-600 text-white py-3 rounded text-xs font-black uppercase shadow-lg shadow-green-900/20 active:scale-95 transition">
                    Run Process
                </button>
            </div>
        </aside>

        <main class="flex-1 flex flex-col bg-[#0f0f11]">
            <div id="tabs-bar" class="flex bg-black overflow-x-auto h-9 items-center px-2 gap-1 border-b border-[#1f1f23]"></div>
            <div id="editor-container" class="flex-1"></div>
        </main>

        <div id="resizer" class="w-1 bg-[#1f1f23] hover:bg-green-500 cursor-col-resize"></div>
        <div id="output-panel" class="w-1/3 flex flex-col bg-black border-l border-[#1f1f23]">
            <div class="h-9 border-b border-[#1f1f23] flex items-center justify-between px-4 bg-[#0a0a0c]">
                <div class="flex gap-4 h-full">
                    <button id="tab-term" onclick="switchOutput('term')" class="text-[10px] font-black text-green-500 border-b-2 border-green-500 h-full">CONSOLE</button>
                    <button id="tab-web" onclick="switchOutput('web')" class="text-[10px] font-black text-gray-600 h-full">PREVIEW</button>
                </div>
                <button onclick="clearConsole()" class="text-[10px] text-gray-600 hover:text-white uppercase font-bold">Clear</button>
            </div>
            
            <div id="console-view" class="flex-1 overflow-y-auto p-4">
                <div id="terminal-output" class="text-gray-400 whitespace-pre-wrap"></div>
            </div>
            
            <div id="preview-view" class="flex-1 hidden bg-white">
                <iframe id="web-frame"></iframe>
            </div>
        </div>
    </div>

    <div id="modal-overlay" class="fixed inset-0 bg-black/90 backdrop-blur-md z-[100] hidden flex items-center justify-center p-6">
        
        <div id="modal-mission" class="bg-[#0f0f11] w-full max-w-4xl rounded-xl border border-[#1f1f23] hidden flex flex-col max-h-[80vh]">
            <div class="p-6 border-b border-[#1f1f23] flex justify-between">
                <h2 class="text-2xl font-black uppercase italic text-green-500">Coding Missions</h2>
                <button onclick="closeModals()" class="text-gray-500 hover:text-white text-2xl">&times;</button>
            </div>
            <div id="mission-grid" class="p-6 grid grid-cols-1 md:grid-cols-2 gap-4 overflow-y-auto"></div>
        </div>

        <div id="modal-about" class="bg-[#0f0f11] w-full max-w-lg rounded-3xl border border-[#1f1f23] hidden p-10 text-center">
            <div class="w-24 h-24 bg-green-500 mx-auto rounded-full flex items-center justify-center mb-6 shadow-[0_0_30px_rgba(34,197,94,0.4)]">
                <i class="fa-solid fa-graduation-cap text-black text-4xl"></i>
            </div>
            <h2 class="text-3xl font-black text-white mb-2 uppercase italic tracking-tighter">Dunston J. Bandasa</h2>
            <p class="text-green-500 font-bold mb-6 tracking-widest text-xs uppercase">Founder | Form 3 Student</p>
            <p class="text-sm text-gray-400 leading-relaxed mb-8 font-medium">
                "Our mission is to democratize education. No student should be limited by their hardware. Coding for free, for everyone, forever."
            </p>
            <div class="bg-black/40 p-5 rounded-2xl border border-[#1f1f23] flex flex-col gap-3">
                <div class="flex justify-between items-center">
                    <span class="text-[10px] text-gray-500 uppercase font-black">Community Contact</span>
                    <span class="text-xs font-mono text-white">Discord: Dunten</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DATABASE & STATE ---
        let editor, activeFileId;
        let db;
        const DB_NAME = "DunstonsCoderDB";
        const PROJECTS = JSON.parse(localStorage.getItem('dc_v20_meta')) || {
            'default': { name: 'Genesis Project', files: [{id:'1', name:'app.py', lang:'python', content:'print("Dunston-Coder v20 Activated.")'}] }
        };
        let curProj = 'default';

        // --- INIT ---
        window.onload = async () => {
            initMonaco();
            renderMissions();
            initResizer();
        };

        function initMonaco() {
            require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs' }});
            require(['vs/editor/editor.main'], () => {
                const f = PROJECTS[curProj].files[0];
                activeFileId = f.id;
                editor = monaco.editor.create(document.getElementById('editor-container'), {
                    value: f.content,
                    language: f.lang === 'py' ? 'python' : f.lang,
                    theme: 'vs-dark',
                    automaticLayout: true,
                    fontSize: 14,
                    fontFamily: 'Fira Code',
                    minimap: { enabled: false },
                    bracketPairColorization: { enabled: true },
                    smoothScrolling: true
                });

                editor.onDidChangeModelContent(() => {
                    const file = PROJECTS[curProj].files.find(x => x.id === activeFileId);
                    file.content = editor.getValue();
                    save();
                    if(file.lang === 'html') handleLivePreview(file.content);
                });

                renderUI();
            });
        }

        // --- CORE ENGINES ---
        async function runCode() {
            const f = PROJECTS[curProj].files.find(x => x.id === activeFileId);
            const term = document.getElementById('terminal-output');
            const btn = document.getElementById('run-btn');

            if(f.lang === 'html') return switchOutput('web');

            switchOutput('term');
            btn.disabled = true;
            btn.innerText = "Processing...";
            term.innerHTML += `<div class="text-blue-500 font-bold mt-2">>>> RUNNING ${f.name} v20...</div>`;

            let payload = { language: f.lang, version: "*", files: [{ content: f.content }] };
            if(f.lang === 'cpp') {
                payload.language = "bash";
                payload.files = [{ name: "s.sh", content: "g++ -pthread m.cpp -o m && ./m" }, { name: "m.cpp", content: f.content }];
            }

            try {
                const res = await fetch('https://emkc.org/api/v2/piston/execute', { method: 'POST', body: JSON.stringify(payload) });
                const data = await res.json();
                if(data.run) {
                    const resOut = (data.run.stdout || '') + (data.run.stderr || '');
                    term.innerHTML += `<div class="${data.run.stderr ? 'ansi-red' : 'text-white'}">${resOut || 'Process completed with no output.'}</div>`;
                }
            } catch (e) { term.innerHTML += `<div class="ansi-red">API Network Error</div>`; }
            
            btn.disabled = false;
            btn.innerText = "Run Process";
            term.parentElement.scrollTop = term.parentElement.scrollHeight;
        }

        function handleLivePreview(content) {
            document.getElementById('web-frame').srcdoc = content;
        }

        // --- UI RENDERERS ---
        function renderUI() {
            const tree = document.getElementById('file-tree');
            const tabs = document.getElementById('tabs-bar');
            tree.innerHTML = ''; tabs.innerHTML = '';

            PROJECTS[curProj].files.forEach(f => {
                const active = f.id === activeFileId;
                tree.innerHTML += `<div onclick="switchFile('${f.id}')" class="p-2 rounded text-[11px] cursor-pointer flex justify-between group transition ${active ? 'bg-green-600/10 text-green-500 border-l-2 border-green-500' : 'text-gray-500 hover:bg-white/5'}">
                    <span><i class="fa-solid fa-file-code mr-2"></i>${f.name}</span>
                </div>`;
                
                tabs.innerHTML += `<div onclick="switchFile('${f.id}')" class="px-4 py-2 text-[10px] font-black cursor-pointer uppercase transition-all flex items-center gap-2 ${active ? 'tab-active' : 'text-gray-600 hover:text-gray-300'}">
                    ${f.name}
                </div>`;
            });
            document.getElementById('lang-select').value = PROJECTS[curProj].files.find(x => x.id === activeFileId).lang;
        }

        function switchFile(id) {
            activeFileId = id;
            const f = PROJECTS[curProj].files.find(x => x.id === id);
            editor.setValue(f.content);
            monaco.editor.setModelLanguage(editor.getModel(), f.lang === 'py' ? 'python' : f.lang);
            renderUI();
        }

        function createNewFile() {
            const n = prompt("Filename (script.py, style.css, etc):", "new_script.py");
            if(!n) return;
            const l = n.split('.').pop();
            const id = Date.now().toString();
            PROJECTS[curProj].files.push({ id, name: n, lang: l === 'py' ? 'python' : l, content: '' });
            switchFile(id);
        }

        function switchOutput(t) {
            document.getElementById('console-view').classList.toggle('hidden', t !== 'term');
            document.getElementById('preview-view').classList.toggle('hidden', t !== 'web');
            document.getElementById('tab-term').className = t === 'term' ? "text-[10px] font-black text-green-500 border-b-2 border-green-500 h-full" : "text-[10px] font-black text-gray-600 h-full";
            document.getElementById('tab-web').className = t === 'web' ? "text-[10px] font-black text-green-500 border-b-2 border-green-500 h-full" : "text-[10px] font-black text-gray-600 h-full";
        }

        // --- MISSIONS & AI ---
        function renderMissions() {
            const m = [
                { t: "Logic: Fibonacci", l: "python", d: "Generate sequence up to 100", c: "a, b = 0, 1\nwhile a < 100:\n    print(a)\n    a, b = b, a+b" },
                { t: "Web: Dark Mode UI", l: "html", d: "Build a sleek card in CSS", c: "<body style='background:#111; color:white; font-family:sans-serif;'>\n<div style='border:1px solid #333; padding:20px; border-radius:10px;'>\n  <h2>Dark Card</h2>\n  <p>Hello Dunston</p>\n</div></body>" }
            ];
            const grid = document.getElementById('mission-grid');
            m.forEach(i => {
                grid.innerHTML += `<div onclick="loadMission('${i.c}', '${i.l}')" class="bg-black p-5 rounded-2xl border border-[#1f1f23] hover:border-green-500 cursor-pointer transition group">
                    <div class="text-[9px] text-green-500 font-bold uppercase mb-1">${i.l}</div>
                    <div class="font-black text-white italic">${i.t}</div>
                    <p class="text-[11px] text-gray-500 mt-2">${i.d}</p>
                </div>`;
            });
        }
        function loadMission(c, l) {
            const id = Date.now().toString();
            PROJECTS[curProj].files.push({ id, name: `mission_${l}`, lang: l, content: c });
            switchFile(id);
            closeModals();
        }

        function getAIHint() {
            const f = PROJECTS[curProj].files.find(x => x.id === activeFileId);
            let hint = "Try writing 'print(\"Hello\")' to start.";
            if(f.lang === 'python') hint = "Tip: Use 'for i in range(5):' to loop five times.";
            if(f.lang === 'html') hint = "Tip: Use <style> tags to change colors.";
            alert("DUNSTON AI: " + hint);
        }

        // --- UTILS ---
        function save() { localStorage.setItem('dc_v20_meta', JSON.stringify(PROJECTS)); }
        function openModal(id) { document.getElementById('modal-overlay').classList.remove('hidden'); document.getElementById(`modal-${id}`).classList.remove('hidden'); }
        function closeModals() { document.getElementById('modal-overlay').classList.add('hidden'); document.querySelectorAll('.hidden').forEach(m => {}); }
        function clearConsole() { document.getElementById('terminal-output').innerHTML = ''; }
        function exportProject() { const blob = new Blob([JSON.stringify(PROJECTS)], {type: 'application/json'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'dunston_v20.json'; a.click(); }

        function initResizer() {
            const resizer = document.getElementById('resizer');
            const output = document.getElementById('output-panel');
            resizer.addEventListener('mousedown', (e) => {
                const move = (md) => {
                    const w = window.innerWidth - md.clientX;
                    if(w > 200 && w < 800) output.style.width = w + 'px';
                };
                document.addEventListener('mousemove', move);
                document.addEventListener('mouseup', () => document.removeEventListener('mousemove', move));
            });
        }
        
        // Hide modals on overlay click
        document.getElementById('modal-overlay').onclick = (e) => { if(e.target.id === 'modal-overlay') closeModals(); };
    </script>
</body>
</html>
