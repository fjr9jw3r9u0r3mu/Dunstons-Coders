<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dunstons-Coder v18 | Nexus</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>

    <style>
        :root { --bg-dark: #09090b; --bg-panel: #18181b; --border: #27272a; --accent: #22c55e; }
        body { background: var(--bg-dark); color: #e4e4e7; font-family: 'Inter', sans-serif; height: 100vh; overflow: hidden; }
        .monaco-editor { padding-top: 10px; }
        #terminal-output { font-family: 'Fira Code', monospace; font-size: 13px; line-height: 1.5; white-space: pre-wrap; }
        .modal-anim { animation: slideIn 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes slideIn { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .spin { animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        .ansi-red { color: #f87171; } .ansi-green { color: #4ade80; }
        iframe { background: white; width: 100%; height: 100%; border: none; }
    </style>
</head>
<body class="flex flex-col select-none">

    <header class="h-14 bg-[#18181b] border-b border-[#27272a] flex items-center justify-between px-4 z-20 shadow-md">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-gradient-to-br from-green-500 to-green-700 rounded flex items-center justify-center shadow-lg">
                <i class="fa-solid fa-code text-white text-sm"></i>
            </div>
            <div>
                <h1 class="font-bold text-lg leading-none text-white uppercase tracking-tighter">DUNSTONS-<span class="text-green-500">CODER</span></h1>
                <div class="text-[9px] text-gray-500 font-mono tracking-widest uppercase">v18.0 NEXUS | BY DUNSTON</div>
            </div>
        </div>

        <div class="flex items-center gap-2">
            <button onclick="openModal('mission')" class="bg-indigo-600/10 text-indigo-400 hover:bg-indigo-600 hover:text-white border border-indigo-600/50 px-3 py-1.5 rounded text-xs font-bold transition flex items-center gap-2">
                <i class="fa-solid fa-rocket"></i> MISSIONS
            </button>
            <button onclick="openModal('about')" class="bg-[#27272a] hover:bg-[#3f3f46] text-gray-300 px-3 py-1.5 rounded text-xs font-bold transition flex items-center gap-2">
                <i class="fa-solid fa-user-graduate"></i> FOUNDER
            </button>
            <div class="h-6 w-px bg-[#3f3f46] mx-1"></div>
            <button onclick="saveProject()" class="text-green-500 hover:text-green-400 p-2" title="Save Project"><i class="fa-solid fa-floppy-disk"></i></button>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        <aside class="w-64 bg-[#09090b] border-r border-[#27272a] flex flex-col flex-shrink-0">
            <div class="p-3 border-b border-[#27272a]">
                <button onclick="createNewFile()" class="w-full bg-[#27272a] hover:bg-[#3f3f46] text-xs py-2 rounded text-white border border-[#3f3f46] font-bold">+ NEW FILE</button>
            </div>
            <div id="file-list" class="flex-1 overflow-y-auto p-2 space-y-1"></div>
            
            <div class="p-3 border-t border-[#27272a] bg-[#0c0c0e]">
                <div class="text-[9px] text-gray-500 font-bold uppercase mb-2 tracking-widest">Compiler Settings</div>
                <select id="lang-select" onchange="updateLang()" class="w-full bg-[#27272a] text-xs text-white p-2 rounded outline-none border border-[#3f3f46] mb-3">
                    <option value="python">Python 3.10</option>
                    <option value="cpp">C++ (Pthread Fix)</option>
                    <option value="java">Java 15</option>
                    <option value="javascript">Node.js</option>
                    <option value="html">HTML Webview</option>
                </select>
                <button id="run-btn" onclick="runCode()" class="w-full bg-green-600 hover:bg-green-500 text-white py-2.5 rounded text-sm font-black transition flex items-center justify-center gap-2 shadow-lg shadow-green-900/20">
                    <i class="fa-solid fa-play"></i> RUN CODE
                </button>
            </div>
        </aside>

        <main class="flex-1 flex flex-col min-w-0 bg-[#1e1e1e]">
            <div id="tabs-bar" class="flex bg-[#18181b] border-b border-[#27272a] overflow-x-auto h-9"></div>
            <div id="editor-container" class="flex-1 relative"></div>
        </main>

        <div class="w-1/3 bg-[#09090b] border-l border-[#27272a] flex flex-col flex-shrink-0">
            <div class="h-9 bg-[#18181b] border-b border-[#27272a] flex items-center justify-between px-3">
                <span class="text-[10px] font-black text-gray-500 uppercase tracking-widest">Output Console</span>
                <button onclick="clearConsole()" class="text-xs text-gray-500 hover:text-white"><i class="fa-solid fa-trash-can"></i></button>
            </div>
            <div id="view-console" class="flex-1 flex flex-col h-full overflow-hidden">
                <div id="terminal-output" class="flex-1 p-3 overflow-y-auto text-gray-300"></div>
            </div>
            <div id="view-webview" class="flex-1 hidden h-full bg-white"><iframe id="web-frame"></iframe></div>
        </div>
    </div>

    <div id="modal-overlay" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        
        <div id="modal-mission" class="bg-[#18181b] w-full max-w-2xl rounded-xl border border-[#27272a] shadow-2xl modal-anim hidden flex flex-col p-6">
            <h2 class="text-xl font-bold text-white mb-4"><i class="fa-solid fa-crosshairs text-indigo-500 mr-2"></i>Mission Control</h2>
            <div id="mission-list" class="space-y-3"></div>
            <button onclick="closeModals()" class="mt-6 text-gray-500 hover:text-white text-sm">Close</button>
        </div>

        <div id="modal-about" class="bg-[#18181b] w-full max-w-md rounded-xl border border-[#27272a] shadow-2xl modal-anim hidden flex flex-col p-6 text-center">
            <div class="w-20 h-20 bg-green-500/20 rounded-full mx-auto flex items-center justify-center mb-4 border border-green-500/50">
                <i class="fa-solid fa-graduation-cap text-3xl text-green-500"></i>
            </div>
            <h2 class="text-2xl font-black text-white uppercase tracking-tight">DUNSTON jude bandasa</h2>
            <p class="text-green-500 font-bold mb-4 italic">Form 3 Student & Founder</p>
            <p class="text-sm text-gray-400 leading-relaxed mb-6">
                "Our mission is to help the world learn coding for free with no limitations."
            </p>
            <div class="bg-[#09090b] p-4 rounded-lg border border-[#27272a] flex items-center justify-between mb-6">
                <div class="flex items-center gap-3">
                    <i class="fa-brands fa-discord text-indigo-400"></i>
                    <span class="text-sm font-mono text-white">Dunten</span>
                </div>
                <span class="text-[10px] text-gray-500 font-bold uppercase">Discord Contact</span>
            </div>
            <button onclick="closeModals()" class="w-full bg-[#27272a] hover:bg-[#3f3f46] text-white py-2 rounded font-bold transition">BACK TO CODE</button>
        </div>
    </div>

    <script>
        let editor; 
        let files = JSON.parse(localStorage.getItem('dc_v18_nexus')) || [
            { id: '1', name: 'hello.py', lang: 'python', content: 'print("Welcome to Dunstons-Coder Nexus")\nprint("Mission: Free coding for everyone.")' }
        ];
        let activeId = files[0].id;

        window.addEventListener('load', () => { initMonaco(); renderMissions(); });

        function initMonaco() {
            require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs' }});
            require(['vs/editor/editor.main'], function() {
                editor = monaco.editor.create(document.getElementById('editor-container'), {
                    value: files.find(f => f.id === activeId).content,
                    language: getLang(files.find(f => f.id === activeId).lang),
                    theme: 'vs-dark', automaticLayout: true, fontSize: 14, fontFamily: 'Fira Code', minimap: { enabled: false }
                });
                editor.onDidChangeModelContent(() => {
                    files.find(f => f.id === activeId).content = editor.getValue();
                    localStorage.setItem('dc_v18_nexus', JSON.stringify(files));
                });
                renderUI();
            });
        }

        async function runCode() {
            const f = files.find(x => x.id === activeId);
            const term = document.getElementById('terminal-output');
            const btn = document.getElementById('run-btn');
            
            if(f.lang === 'html') {
                document.getElementById('view-console').classList.add('hidden');
                document.getElementById('view-webview').classList.remove('hidden');
                document.getElementById('web-frame').srcdoc = f.content;
                return;
            }

            document.getElementById('view-console').classList.remove('hidden');
            document.getElementById('view-webview').classList.add('hidden');
            term.innerHTML = '<div class="text-yellow-500"><i class="fa-solid fa-circle-notch spin"></i> Executing...</div>';
            btn.disabled = true;

            let payload = { language: f.lang, version: "*", files: [{ content: f.content }] };
            if(f.lang === 'cpp') {
                payload.language = "bash";
                payload.files = [{ name: "r.sh", content: "g++ -pthread m.cpp -o m && ./m" }, { name: "m.cpp", content: f.content }];
            }

            try {
                const res = await fetch('https://emkc.org/api/v2/piston/execute', { method: 'POST', body: JSON.stringify(payload) });
                const data = await res.json();
                term.innerHTML = '';
                
                if(data.run) {
                    const out = data.run.stdout || '';
                    const err = data.run.stderr || '';
                    if(!out && !err) {
                        term.innerHTML = '<div class="text-gray-500 border border-gray-800 p-2 rounded"><b>Process finished with no output.</b><br>Try adding a print() or cout statement to see a result.</div>';
                    } else {
                        term.innerHTML = `<span class="text-white">${escape(out)}</span><span class="ansi-red">${escape(err)}</span>`;
                    }
                }
            } catch(e) { term.innerHTML = `<span class="ansi-red">API Network Error.</span>`; }
            btn.disabled = false;
        }

        function renderUI() {
            const list = document.getElementById('file-list');
            const tabs = document.getElementById('tabs-bar');
            list.innerHTML = ''; tabs.innerHTML = '';
            files.forEach(f => {
                const active = f.id === activeId;
                list.innerHTML += `<div onclick="switchFile('${f.id}')" class="p-2 rounded text-xs cursor-pointer flex justify-between group ${active ? 'bg-[#27272a] border-l-2 border-green-500 text-white' : 'text-gray-500'}"><span>${f.name}</span></div>`;
                tabs.innerHTML += `<div onclick="switchFile('${f.id}')" class="px-4 py-2 text-xs border-r border-[#27272a] cursor-pointer h-full flex items-center ${active ? 'bg-[#1e1e1e] text-green-400 border-t-2 border-green-500' : 'text-gray-500'}">${f.name}</div>`;
            });
            document.getElementById('lang-select').value = files.find(f => f.id === activeId).lang;
        }

        function switchFile(id) { activeId = id; const f = files.find(x => x.id === id); editor.setValue(f.content); monaco.editor.setModelLanguage(editor.getModel(), getLang(f.lang)); renderUI(); }
        function createNewFile() { const n = prompt("Filename:", "script.py"); if(n) { files.push({id: Date.now().toString(), name: n, lang: n.split('.').pop() === 'py' ? 'python' : 'cpp', content: ''}); switchFile(files[files.length-1].id); } }
        function openModal(id) { document.getElementById('modal-overlay').classList.remove('hidden'); document.getElementById(`modal-${id}`).classList.remove('hidden'); }
        function closeModals() { document.getElementById('modal-overlay').classList.add('hidden'); document.querySelectorAll('.modal-anim').forEach(m => m.classList.add('hidden')); }
        function getLang(l) { return l === 'py' ? 'python' : (l === 'js' ? 'javascript' : l); }
        function escape(t) { return t.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;"); }
        function clearConsole() { document.getElementById('terminal-output').innerHTML = ''; }
        function saveProject() { localStorage.setItem('dc_v18_nexus', JSON.stringify(files)); alert("Project Saved to Local Browser."); }

        function renderMissions() {
            const m = [{t: "The Starter", d: "Learn to output data", c: 'print("I am a coder now.")'}];
            const l = document.getElementById('mission-list');
            l.innerHTML = '';
            m.forEach(i => {
                l.innerHTML += `<div onclick="loadM('${i.c}')" class="p-3 bg-[#27272a] rounded border border-[#3f3f46] hover:border-green-500 cursor-pointer transition"><div class="font-bold text-white text-sm">${i.t}</div><div class="text-[10px] text-gray-500">${i.d}</div></div>`;
            });
        }
        function loadM(c) { files.push({id: Date.now().toString(), name: "mission.py", lang: "python", content: c}); switchFile(files[files.length-1].id); closeModals(); }
    </script>
</body>
</html>
