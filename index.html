<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dunstons-Coder | Omega v25 Ultra</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700;800&family=Fira+Code:wght@400;500&display=swap');
        :root { --bg: #050505; --panel: #0d0d0f; --accent: #10b981; --border: #1f1f23; --text: #f4f4f5; }
        body { background: var(--bg); color: var(--text); font-family: 'Plus Jakarta Sans', sans-serif; height: 100vh; overflow: hidden; margin: 0; }
        .monaco-editor { padding-top: 10px; background: transparent !important; }
        .tab-active { color: var(--accent); border-bottom: 2px solid var(--accent); background: rgba(16, 185, 129, 0.05); }
        pre { white-space: pre-wrap; word-wrap: break-word; font-family: 'Fira Code', monospace; }
        .err-text { color: #ef4444; font-weight: bold; }
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-thumb { background: #27272a; border-radius: 10px; }
    </style>
</head>
<body class="flex flex-col">

<header class="h-16 border-b border-[#1f1f23] flex items-center justify-between px-6 bg-black/50 z-50">
    <div class="flex items-center gap-8">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-gradient-to-br from-emerald-400 to-green-700 rounded-xl flex items-center justify-center shadow-lg shadow-emerald-500/20">
                <i class="fa-solid fa-atom text-black text-xl"></i>
            </div>
            <div>
                <h1 class="font-extrabold text-sm tracking-widest uppercase italic leading-none">Dunstons-<span class="text-emerald-500">Coder</span></h1>
                <span class="text-[9px] text-gray-500 font-bold tracking-[0.3em]">OMEGA V25 ULTRA</span>
            </div>
        </div>
        <button onclick="openModal('founder')" class="px-4 py-1.5 text-[10px] font-black uppercase text-emerald-500 bg-emerald-500/10 rounded-full border border-emerald-500/20">Founder</button>
    </div>
    <div class="flex items-center gap-6">
        <div class="flex flex-col items-end">
            <div class="text-[9px] font-bold text-gray-500 uppercase">Rank: Level <span id="user-level" class="text-emerald-500">1</span></div>
            <div class="w-32 h-1 bg-[#1f1f23] rounded-full mt-1 overflow-hidden">
                <div id="xp-bar" class="h-full bg-emerald-500 w-0 transition-all duration-500"></div>
            </div>
        </div>
        <button onclick="exportProject()" class="w-10 h-10 flex items-center justify-center rounded-full bg-[#121214] border border-[#1f1f23] hover:border-emerald-500 text-gray-400 hover:text-white transition">
            <i class="fa-solid fa-download"></i>
        </button>
    </div>
</header>

<div class="flex flex-1 overflow-hidden">
    <aside class="w-64 bg-black border-r border-[#1f1f23] flex flex-col p-4 gap-6">
        <button onclick="createNewFile()" class="w-full bg-emerald-500 hover:bg-emerald-400 text-black py-3 rounded-xl font-extrabold text-xs uppercase transition-all shadow-lg shadow-emerald-500/20">+ New Source File</button>
        <div class="flex-1 flex flex-col gap-2 overflow-hidden">
            <h3 class="text-[10px] font-black text-gray-600 uppercase tracking-widest px-2">Project Explorer</h3>
            <div id="file-tree" class="space-y-1 overflow-y-auto pr-2"></div>
        </div>
        <div class="bg-[#0d0d0f] rounded-2xl border border-[#1f1f23] p-4">
            <label class="text-[9px] font-bold text-gray-500 uppercase block mb-2">Runtime</label>
            <select id="lang-select" onchange="updateLangManual()" class="w-full bg-black text-xs text-white p-3 rounded-lg border border-[#1f1f23] outline-none focus:border-emerald-500 transition">
                <option value="python">Python 3</option>
                <option value="cpp">C++</option>
                <option value="java">Java</option>
                <option value="javascript">Node.js</option>
                <option value="html">Web Live</option>
            </select>
            <button id="run-btn" onclick="runCode()" class="w-full mt-4 bg-white text-black py-3 rounded-lg font-black text-xs uppercase hover:bg-emerald-500 transition-all flex items-center justify-center gap-2">
                <i class="fa-solid fa-play"></i> Execute
            </button>
        </div>
    </aside>

    <main class="flex-1 flex flex-col bg-[#050505]">
        <div id="tabs-bar" class="flex bg-black border-b border-[#1f1f23] h-12 items-center px-4 gap-2 overflow-x-auto"></div>
        <div id="editor-container" class="flex-1 relative"></div>
        <div class="h-8 bg-[#0d0d0f] border-t border-[#1f1f23] flex items-center justify-between px-4 text-[10px] font-bold text-gray-500">
            <div class="flex gap-4">
                <span><i class="fa-solid fa-check-circle text-emerald-500"></i> Local-Sync: OK</span>
                <span id="char-count">0 chars</span>
            </div>
            <span>OMEGA ENGINE v25.0</span>
        </div>
    </main>

    <div id="resizer" class="w-1 bg-[#1f1f23] hover:bg-emerald-500 cursor-col-resize transition-colors"></div>
    <div id="output-panel" class="w-1/3 flex flex-col bg-black border-l border-[#1f1f23]">
        <div class="h-12 border-b border-[#1f1f23] flex items-center justify-between px-6 bg-[#0d0d0f]">
            <div class="flex gap-6 h-full">
                <button onclick="switchOut('term')" id="tab-term" class="text-[10px] font-black text-emerald-500 border-b-2 border-emerald-500 h-full uppercase">Console</button>
                <button onclick="switchOut('web')" id="tab-web" class="text-[10px] font-black text-gray-500 h-full uppercase">Live View</button>
            </div>
            <button onclick="clearConsole()" class="text-[10px] font-bold text-gray-600 hover:text-white uppercase">Clear</button>
        </div>
        <div id="console-view" class="flex-1 p-6 overflow-y-auto font-mono text-sm bg-black">
            <div id="terminal-output" class="text-gray-400"></div>
        </div>
        <div id="preview-view" class="flex-1 hidden bg-white">
            <iframe id="web-frame" class="w-full h-full" sandbox="allow-scripts allow-same-origin"></iframe>
        </div>
    </div>
</div>

<div id="modal-overlay" class="fixed inset-0 bg-black/95 backdrop-blur-xl z-[100] hidden flex items-center justify-center p-6" onclick="closeModals()">
    <div id="modal-founder" class="bg-[#0d0d0f] w-full max-w-xl rounded-[2rem] border border-[#1f1f23] p-12 text-center relative hidden" onclick="event.stopPropagation()">
        <div class="w-28 h-28 bg-gradient-to-br from-emerald-400 to-green-600 rounded-3xl mx-auto flex items-center justify-center mb-8 rotate-12 shadow-2xl shadow-emerald-500/20"><i class="fa-solid fa-crown text-black text-5xl"></i></div>
        <h2 class="text-4xl font-black text-white mb-2 uppercase italic tracking-tighter">DUNSTON JUDE BANDASA</h2>
        <p class="text-emerald-500 font-extrabold mb-8 tracking-[0.2em] text-xs uppercase">Founder | Visionary</p>
        <p class="text-gray-400 leading-relaxed mb-10 italic">"Empowering the next generation of developers with tools that work for them."</p>
        <button onclick="closeModals()" class="bg-white text-black text-[10px] font-black px-10 py-4 rounded-xl uppercase hover:bg-emerald-500 transition">Return to IDE</button>
    </div>
</div>

<script>
    let editor, activeId, saveTimeout;
    let xp = parseInt(localStorage.getItem('omega_xp')) || 0;
    let projectData = JSON.parse(localStorage.getItem('omega_project')) || {
        files: [
            { id: '1', name: 'main.py', lang: 'python', content: 'print("Omega v25 Active")' },
            { id: '2', name: 'index.html', lang: 'html', content: '<h1>Hello Omega</h1>' }
        ]
    };

    const EXT_MAP = { py: 'python', cpp: 'cpp', java: 'java', js: 'javascript', html: 'html', css: 'css' };

    // Initialize Monaco
    require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs' }});
    require(['vs/editor/editor.main'], function() {
        const file = projectData.files[0];
        activeId = file.id;

        editor = monaco.editor.create(document.getElementById('editor-container'), {
            value: file.content,
            language: file.lang,
            theme: 'vs-dark',
            automaticLayout: true,
            fontSize: 15,
            fontFamily: 'Fira Code',
            minimap: { enabled: false },
            padding: { top: 20 },
            scrollBeyondLastLine: false,
        });

        editor.onDidChangeModelContent(() => {
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(saveData, 500);
            document.getElementById('char-count').innerText = `${editor.getValue().length} chars`;
        });

        initResizer();
        renderProject();
        updateXP(0);
    });

    function saveData() {
        const file = projectData.files.find(f => f.id === activeId);
        if (file) {
            file.content = editor.getValue();
            localStorage.setItem('omega_project', JSON.stringify(projectData));
        }
    }

    async function runCode() {
        const file = projectData.files.find(f => f.id === activeId);
        const out = document.getElementById('terminal-output');
        
        if (file.lang === 'html') {
            switchOut('web');
            document.getElementById('web-frame').srcdoc = file.content;
            return;
        }

        switchOut('term');
        out.innerHTML += `<div class="text-emerald-500 font-bold mt-2">>>> Running ${file.name}...</div>`;
        try {
            const res = await fetch('https://emkc.org/api/v2/piston/execute', {
                method: 'POST',
                body: JSON.stringify({ language: file.lang, version: "*", files: [{ content: file.content }] })
            });
            const data = await res.json();
            if (data.run.stdout) out.innerHTML += `<pre class="text-gray-300">${data.run.stdout}</pre>`;
            if (data.run.stderr) out.innerHTML += `<pre class="err-text">${data.run.stderr}</pre>`;
            updateXP(25);
        } catch (e) { out.innerHTML += `<div class="err-text">API Error</div>`; }
        out.parentElement.scrollTop = out.parentElement.scrollHeight;
    }

    function createNewFile() {
        const name = prompt("Filename:", "script.py");
        if (!name) return;
        const id = Date.now().toString();
        projectData.files.push({ id, name, lang: EXT_MAP[name.split('.').pop()] || 'plaintext', content: '' });
        switchFile(id);
    }

    function switchFile(id) {
        saveData();
        activeId = id;
        const f = projectData.files.find(x => x.id === id);
        editor.setValue(f.content);
        monaco.editor.setModelLanguage(editor.getModel(), f.lang);
        renderProject();
    }

    function renderProject() {
        const tree = document.getElementById('file-tree');
        const tabs = document.getElementById('tabs-bar');
        tree.innerHTML = ''; tabs.innerHTML = '';
        projectData.files.forEach(f => {
            const active = f.id === activeId;
            tree.innerHTML += `<div onclick="switchFile('${f.id}')" class="p-3 rounded-xl text-[11px] cursor-pointer flex justify-between transition-all ${active ? 'bg-emerald-500/10 text-emerald-400 border border-emerald-500/20' : 'text-gray-500 hover:bg-white/5'}">
                <span class="font-bold"><i class="fa-solid fa-file-code mr-3"></i>${f.name}</span>
            </div>`;
            tabs.innerHTML += `<div onclick="switchFile('${f.id}')" class="px-6 py-2 text-[10px] font-black cursor-pointer uppercase transition-all ${active ? 'tab-active' : 'text-gray-600 hover:text-gray-300'}">${f.name}</div>`;
        });
        document.getElementById('lang-select').value = projectData.files.find(f => f.id === activeId).lang;
    }

    function switchOut(t) {
        document.getElementById('console-view').classList.toggle('hidden', t !== 'term');
        document.getElementById('preview-view').classList.toggle('hidden', t !== 'web');
        document.getElementById('tab-term').className = t === 'term' ? "text-[10px] font-black text-emerald-500 border-b-2 border-emerald-500 h-full uppercase" : "text-[10px] font-black text-gray-500 h-full uppercase";
        document.getElementById('tab-web').className = t === 'web' ? "text-[10px] font-black text-emerald-500 border-b-2 border-emerald-500 h-full uppercase" : "text-[10px] font-black text-gray-500 h-full uppercase";
    }

    function updateXP(v) {
        xp += v;
        localStorage.setItem('omega_xp', xp);
        document.getElementById('user-level').innerText = Math.floor(xp / 100) + 1;
        document.getElementById('xp-bar').style.width = (xp % 100) + '%';
    }

    function initResizer() {
        const resizer = document.getElementById('resizer'), panel = document.getElementById('output-panel');
        let dragging = false;
        resizer.addEventListener('mousedown', () => dragging = true);
        document.addEventListener('mousemove', (e) => {
            if (!dragging) return;
            const w = window.innerWidth - e.clientX;
            if (w > 200 && w < 900) panel.style.width = w + 'px';
        });
        document.addEventListener('mouseup', () => dragging = false);
    }

    function openModal(id) { document.getElementById('modal-overlay').classList.remove('hidden'); document.getElementById(`modal-${id}`).classList.remove('hidden'); }
    function closeModals() { document.getElementById('modal-overlay').classList.add('hidden'); document.querySelectorAll('[id^="modal-"]').forEach(m => m.classList.add('hidden')); }
    function clearConsole() { document.getElementById('terminal-output').innerHTML = ''; }
    function exportProject() {
        const blob = new Blob([JSON.stringify(projectData)], {type: 'application/json'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'omega_v25.json'; a.click();
    }
    function updateLangManual() {
        const f = projectData.files.find(x => x.id === activeId);
        f.lang = document.getElementById('lang-select').value;
        monaco.editor.setModelLanguage(editor.getModel(), f.lang);
    }
</script>
</body>
</html>
