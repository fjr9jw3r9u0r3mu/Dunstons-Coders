<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Dunstons-Coder | Elite IDE</title>
<link rel="stylesheet" data-name="vs/editor/editor.main" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.43.0/min/vs/editor/editor.main.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root{ --bg:#05070a; --panel:#0d1117; --accent:#00ff41; --border:#2b3238; --text:#e6edf3; --vs-bg:#1e1e1e; }
*{box-sizing:border-box; outline:none;}
body,html{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui;overflow:hidden;display:flex;flex-direction:column}

/* Z-INDEX HIERARCHY: 
   1: App Body | 10: Sidebar | 20: Resizer | 100: Header 
   1000: Console | 5000: FullScreen | 9999: Modals | 99999: Lock */

.header{height:60px;background:rgba(13,17,23,0.95);backdrop-filter:blur(10px);display:flex;align-items:center;justify-content:space-between;padding:0 25px;border-bottom:1px solid var(--border);z-index:100}
.logo{color:var(--accent);font-weight:900;font-size:18px;letter-spacing:1.5px}
.btn{background:#1a2025;color:var(--text);border:1px solid var(--border);padding:8px 14px;border-radius:6px;cursor:pointer;font-weight:600;font-size:11px;display:flex;align-items:center;gap:8px;transition:0.2s}
.btn:hover{border-color:var(--accent);background:#252b32}

.app-body{flex:1;display:flex;min-height:0;position:relative;z-index:1}
.sidebar{width:250px;background:var(--panel);border-right:1px solid var(--border);display:flex;flex-direction:column;transition:0.3s;z-index:10;flex-shrink:0}
.sidebar.minimized{width:0;opacity:0;pointer-events:none}

/* Fix Editor/Preview Ratios */
.editor-container{width:50%; display:flex; flex-direction:column; background:var(--vs-bg); transition:width 0.1s ease; overflow:hidden; z-index:5}
.editor-container.hidden{width:0 !important; border:none}
#monaco-container{flex:1; width:100%}

.resizer-bar{width:6px; background:#111; cursor:col-resize; z-index:20; transition:0.2s; flex-shrink:0}
.resizer-bar:hover, .resizer-bar.active{background:var(--accent)}
.resizer-bar.hidden{display:none}

/* Right Side Stack */
.preview-pane{flex:1; display:flex; flex-direction:column; background:#fff; position:relative; min-width:0; z-index:5}
.preview-pane.full-mode { position:fixed !important; inset:0 !important; z-index:5000 !important; width:100% !important; height:100% !important; }

iframe{flex:1; width:100%; border:none; background:#fff; display:block}

/* Fixed Console Layering */
.console-wrapper{background:#000; display:flex; flex-direction:column; transition:0.3s; border-top:2px solid var(--border); z-index:1000; position:relative}
.console-wrapper.maximized{height:30%; min-height:150px}
.console-wrapper.minimized{height:40px}
.console-header{height:40px; background:#0f1418; display:flex; justify-content:space-between; align-items:center; padding:0 15px; cursor:pointer; flex-shrink:0}
#langOutput{flex:1; padding:15px; font-family:'Consolas', monospace; color:var(--accent); overflow-y:auto; white-space:pre-wrap; font-size:13px; background:#000}

/* Project Items */
.proj-item{padding:12px; background:#161b22; margin:5px 10px; border-radius:8px; cursor:pointer; font-size:12px; display:flex; justify-content:space-between; border:1px solid transparent; transition:0.2s}
.proj-item:hover{background:#1c2128}
.proj-item.active{border-color:var(--accent); background:rgba(0,255,65,0.05)}

/* Overlays */
#showEditorBtn{display:none; position:fixed; bottom:60px; left:20px; z-index:2000; background:var(--accent); color:#000; padding:12px 24px; border-radius:50px; font-weight:800; cursor:pointer; border:none; box-shadow:0 10px 20px rgba(0,0,0,0.5)}
.modal{display:none; position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:9999; place-items:center; backdrop-filter:blur(8px)}
.modal-content{background:var(--panel); padding:40px; border:1px solid var(--border); width:90%; max-width:500px; border-radius:20px; text-align:center}

#lockScreen{display:none; position:fixed; inset:0; background:#000; z-index:99999; place-items:center; text-align:center}
select{background:#1a2025; color:var(--accent); border:1px solid var(--border); padding:6px; border-radius:6px; font-weight:bold; cursor:pointer}
</style>
</head>
<body>

<div id="lockScreen">
    <div class="modal-content" style="background:#0a0a0a">
        <div class="logo">DUNSTONS-CODER</div>
        <p style="opacity:0.5; font-size:11px; margin-bottom:20px">ENCRYPTED ACCESS ONLY</p>
        <input type="password" id="passInput" placeholder="Passkey" style="width:100%; padding:15px; background:#000; border:1px solid var(--border); color:white; margin-bottom:15px; border-radius:8px; text-align:center; font-size:18px">
        <button class="btn" style="width:100%; justify-content:center; background:var(--accent); color:#000; padding:15px" onclick="unlock()">DECRYPT & ENTER</button>
    </div>
</div>

<header class="header">
    <div style="display:flex;align-items:center;gap:15px">
        <div class="logo">DUNSTONS-CODER</div>
        <button class="btn" onclick="toggleSidebar()"><i class="fa-solid fa-folder-tree"></i></button>
        <select id="langSelect" onchange="changeLang()">
            <option value="html">WEB ENGINE</option>
            <option value="python">PYTHON 3</option>
            <option value="lua">LUA</option>
            <option value="java">JAVA</option>
            <option value="cpp">C++</option>
        </select>
    </div>
    <div style="display:flex; gap:10px; align-items:center">
        <button class="btn" onclick="toggleFullScreen()"><i class="fa-solid fa-expand"></i> FULL PREVIEW</button>
        <button class="btn" onclick="toggleEditor()"><i class="fa-solid fa-code"></i> EDITOR</button>
        <button class="btn" onclick="openAbout()">MISSION</button>
        <button class="btn" style="background:var(--accent); color:#000" onclick="runCode()">RUN â–¶</button>
    </div>
</header>

<div class="app-body">
    <aside class="sidebar" id="sidebar">
        <div style="padding:15px; font-size:10px; opacity:0.4; letter-spacing:1px">SAVED PROJECTS</div>
        <div id="projectList" style="flex:1; overflow-y:auto"></div>
        <button class="btn" style="margin:15px" onclick="createNewProject()"><i class="fa-solid fa-plus"></i> NEW PROJECT</button>
    </aside>

    <section class="editor-container" id="editorSection">
        <div id="monaco-container"></div>
    </section>

    <div class="resizer-bar" id="resizer"></div>

    <section class="preview-pane" id="previewPane">
        <iframe id="outputFrame"></iframe>
        <div class="console-wrapper minimized" id="consolePane">
            <div class="console-header" onclick="toggleConsole()">
                <span style="font-size:11px; font-weight:bold; color:var(--accent)"><i class="fa-solid fa-terminal"></i> OUTPUT TERMINAL</span>
                <i id="minIcon" class="fa-solid fa-chevron-up"></i>
            </div>
            <div id="langOutput"></div>
        </div>
    </section>
</div>

<button id="showEditorBtn" onclick="toggleEditor()">SHOW EDITOR</button>

<div class="modal" id="aboutModal">
    <div class="modal-content">
        <h2 style="margin:0">Dunston Jude Bandasa</h2>
        <p style="color:var(--accent); font-weight:bold; margin:5px 0">Form 3 Student | Sabah, Malaysia</p>
        <div style="text-align:left; background:rgba(0,0,0,0.4); padding:20px; border-radius:12px; border-left:4px solid var(--accent); margin:25px 0; font-size:14px; line-height:1.6">
            <p><strong>The Mission:</strong> Providing a free, high-performance coding environment for everyone globally with zero limits.</p>
            <p><strong>Sabah Vision:</strong> Empowering local students to master tech from home.</p>
        </div>
        <button class="btn" style="width:100%; justify-content:center; background:var(--accent); color:#000; padding:12px" onclick="closeAbout()">CONTINUE</button>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>
<script>
const PASSKEY = "dunten2011";
let editor, activeProj = localStorage.getItem('DC_LastProj') || 'Default';
let projects = JSON.parse(localStorage.getItem('DC_Storage_V5')) || { 'Default': { code: '<h1>Ready</h1>', lang: 'html' } };

require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.43.0/min/vs' }});
require(['vs/editor/editor.main'], function() {
    editor = monaco.editor.create(document.getElementById('monaco-container'), {
        value: projects[activeProj].code,
        language: projects[activeProj].lang,
        theme: 'vs-dark',
        automaticLayout: true,
        fontSize: 14,
        minimap: { enabled: false }
    });
    editor.onDidChangeModelContent(() => {
        projects[activeProj].code = editor.getValue();
        localStorage.setItem('DC_Storage_V5', JSON.stringify(projects));
    });
    renderProjects();
});

async function runCode() {
    const code = editor.getValue();
    const lang = document.getElementById('langSelect').value;
    const frame = document.getElementById('outputFrame');
    const langDiv = document.getElementById('langOutput');
    
    if(lang === 'html') {
        langDiv.style.display = 'none'; frame.style.display = 'block';
        frame.srcdoc = code;
    } else {
        frame.style.display = 'none'; langDiv.style.display = 'block';
        if(document.getElementById('consolePane').classList.contains('minimized')) toggleConsole();
        langDiv.textContent = '> Initializing Engine...\n> Running...';
        try {
            const res = await fetch('https://emkc.org/api/v2/piston/execute', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({language: lang, version: '*', files: [{name: lang==='java'?'Main.java':'script', content: code}]})
            });
            const data = await res.json();
            langDiv.textContent = (data.run && (data.run.output || data.run.stderr)) || "Process exited with no output.";
        } catch(e) { langDiv.textContent = 'Network Error: ' + e.message; }
    }
}

// GUI & RATIO LOGIC
function toggleFullScreen() { document.getElementById('previewPane').classList.add('full-mode'); }
window.addEventListener('keydown', (e) => { 
    if(e.key === 'Escape') {
        document.getElementById('previewPane').classList.remove('full-mode'); 
    }
});

function toggleEditor() {
    const section = document.getElementById('editorSection');
    const resizer = document.getElementById('resizer');
    const showBtn = document.getElementById('showEditorBtn');
    section.classList.toggle('hidden');
    resizer.classList.toggle('hidden');
    showBtn.style.display = section.classList.contains('hidden') ? 'block' : 'none';
    if(editor) setTimeout(() => editor.layout(), 200);
}

function toggleConsole() {
    const pane = document.getElementById('consolePane');
    const icon = document.getElementById('minIcon');
    pane.classList.toggle('maximized');
    pane.classList.toggle('minimized');
    icon.className = pane.classList.contains('maximized') ? 'fa-solid fa-chevron-down' : 'fa-solid fa-chevron-up';
}

const resizer = document.getElementById('resizer');
resizer.addEventListener('mousedown', (e) => {
    resizer.classList.add('active');
    const onMove = (e) => {
        let p = (e.clientX / window.innerWidth) * 100;
        if(p > 15 && p < 85) {
            document.getElementById('editorSection').style.width = p + '%';
            if(editor) editor.layout();
        }
    };
    const onUp = () => {
        resizer.classList.remove('active');
        window.removeEventListener('mousemove', onMove);
        window.removeEventListener('mouseup', onUp);
    };
    window.addEventListener('mousemove', onMove);
    window.addEventListener('mouseup', onUp);
});

// SYSTEM LOGIC
function toggleSidebar() { document.getElementById('sidebar').classList.toggle('minimized'); }
function unlock() { if(document.getElementById('passInput').value === PASSKEY) document.getElementById('lockScreen').style.display = 'none'; }
function openAbout() { document.getElementById('aboutModal').style.display = 'grid'; }
function closeAbout() { document.getElementById('aboutModal').style.display = 'none'; }
function changeLang() { 
    const l = document.getElementById('langSelect').value;
    monaco.editor.setModelLanguage(editor.getModel(), l);
    projects[activeProj].lang = l;
    localStorage.setItem('DC_Storage_V5', JSON.stringify(projects));
}
function renderProjects() {
    const list = document.getElementById('projectList');
    list.innerHTML = '';
    Object.keys(projects).forEach(name => {
        const div = document.createElement('div');
        div.className = `proj-item ${name === activeProj ? 'active' : ''}`;
        div.innerHTML = `<span><i class="fa-solid fa-code"></i> ${name}</span>`;
        div.onclick = () => {
            activeProj = name;
            localStorage.setItem('DC_LastProj', name);
            editor.setValue(projects[name].code);
            document.getElementById('langSelect').value = projects[name].lang;
            monaco.editor.setModelLanguage(editor.getModel(), projects[name].lang);
            renderProjects();
        };
        list.appendChild(div);
    });
}
function createNewProject() {
    const n = prompt("Project Name:");
    if(n) { projects[n] = {code: '', lang: 'html'}; renderProjects(); }
}
</script>
</body>
</html>
